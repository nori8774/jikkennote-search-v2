# jikkennote-search v1 改善点サマリー

**作成日**: 2025-12-29
**ステータス**: 設計フェーズ
**目的**: 実運用を想定した機能追加・改善

詳細なブレスト記録: [brainstorm-v1-features-2025-12-29.md](./brainstorm-v1-features-2025-12-29.md)

---

## 概要

既存システム（jikkennote-search）は評価可能な状態まで完成しているが、実運用には以下の改善が必要：

1. **マルチテナント対応** - 複数チームで使えるように
2. **ノート取り込み改善** - IT非専門者でも使いやすく
3. **検索機能改善** - 速度向上、再検索、モデル選択
4. **コピー機能強化** - ワークフロー効率化
5. **評価機能改善** - CSV出力、履歴拡大

---

## 1. マルチテナント対応

### キーポイント
- **認証**: Googleログイン（Firebase）
- **チーム**: 1ユーザーが複数チーム所属可
- **権限**: 全員同等（PoC仕様）
- **データ分離**: チームごとに独立したDB・ストレージ

### データ構造
```
teams/
  └── {team_id}/
      ├── chroma-db/
      ├── notes/
      │   ├── new/
      │   └── processed/
      ├── dictionary.yaml
      └── prompts/
```

---

## 2. ノート取り込み改善

### キーポイント
- **アップロード方法**: ローカルファイル / Google Drive
- **アーカイブ**: `processed/`に保存（削除しない）
- **辞書抽出**: Sudachi + LLM → ユーザー確認

### 辞書抽出ロジック
```
新出単語抽出
  ↓
Sudachi形態素解析
  ↓
LLMで判定（複合語 or 表記揺れ）
  ↓
ユーザー確認UI
  ↓
辞書更新
```

**複合語の扱い**:
- 「抗原」「抗体」「抗原抗体反応」→ 別の用語として共存
- 「こうげんこうたい反応」→ 「抗原抗体反応」の表記揺れ

---

## 3. 検索機能改善

### モデル2段階選択

| 用途 | デフォルト | 選択肢 |
|------|-----------|--------|
| **検索・判定** | gpt-4o-mini | gpt-4o, gpt-5, gpt-5.1, gpt-5.2 |
| **要約生成** | gpt-3.5-turbo | gpt-4o-mini, gpt-4o |

**効果**: 要約生成の速度向上（30秒 → 10秒目標）

### 再検索機能

```
初回検索 → 結果確認 → 重点指示追加 → 再検索
```

- 目的・材料・方法はそのまま
- 重点指示のみ追加して再実行

---

## 4. コピー機能強化

### ビューワー画面
- **「検索条件として一括コピー」ボタン**
  - 目的・材料・方法 → 検索ページに遷移・自動入力

### 検索画面
- 各ノートに4つのボタン: **[目的] [材料] [方法] [一括]**
  - クリック → 左フォームに即反映

---

## 5. 評価機能改善

### CSV出力
**カラム**:
```
条件ID, Embeddingモデル, LLMモデル, プロンプト名,
nDCG@10, Precision@10, Recall@10, MRR,
正解1_検出ランク, 正解2_検出ランク, ..., 正解10_検出ランク
```

### その他
- デバッグ表示（入力条件）削除
- 履歴保存: **5件 → 50件**

---

## 技術スタック追加

| 項目 | 技術 |
|------|------|
| 認証 | Firebase Authentication |
| 形態素解析 | Sudachi |
| 新LLMモデル | GPT-5, GPT-5.1, GPT-5.2 |

---

## 実装優先順位

### Phase 1: 基盤整備
1. マルチテナント対応
2. ノート取り込み（ローカルアップロード、アーカイブ）

### Phase 2: コア機能
3. 辞書自動抽出（Sudachi + LLM）
4. モデル2段階選択
5. 再検索機能

### Phase 3: UX改善
6. コピー機能強化
7. 評価機能改善

---

## 影響を受けるドキュメント

- ✅ `product-requirements.md` - 新機能追加
- ✅ `functional-design.md` - 機能詳細
- ✅ `architecture.md` - 技術設計
- ✅ `api-specification.md` - API変更
- ✅ `repository-structure.md` - ディレクトリ構造

---

**次のアクション**: 永続ドキュメントの更新
