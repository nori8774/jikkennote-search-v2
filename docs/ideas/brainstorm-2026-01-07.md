# ブレインストーミング 2026-01-07

## 概要

jikkennote-search-v2 の開発に向けたブレインストーミング・議論の記録。

---

## 議論ログ

### セッション1: コレクション構成の簡素化と検索戦略の見直し

#### 背景・課題

現在の実験ノートは以下の構造:
- **目的**: 実験の目的
- **材料**: `①HbA1c抗体 10mL`、`②NaOH 20mL` のように番号付き
- **方法**: `①、②をビーカーに入れる` のように番号で省略

**問題点**:
- 材料と方法を別コレクションにすると、方法セクションだけでは「何の材料か」がわからない
- 現状は取り込み時にLLMで正規化（①→HbA1c抗体に展開）しているが、処理が複雑

#### 提案アイデア: 2コレクション + クエリ時解釈

**Before（現在）: 3コレクション + 正規化**
```
materials_collection   ← 材料セクションのみ
methods_collection     ← 方法セクションのみ（正規化で①→材料名に展開）
combined_collection    ← ノート全体
```

**After（提案）: 2コレクション + 正規化なし**
```
combined_collection           ← ノート全体（総合軸）
materials_methods_collection  ← 材料+方法セクションを結合（材料・方法軸）
```

- 取り込み時の正規化を廃止
- 検索時にLLMが「①は材料セクションのHbA1c抗体を指す」と文脈から解釈

#### メリット・デメリット比較

| 観点 | 現状（正規化） | 提案（クエリ時解釈） |
|------|--------------|-------------------|
| 取り込み処理 | 複雑（LLM呼び出し） | シンプル |
| 検索精度 | 正規化の精度に依存 | LLMの文脈理解に依存 |
| コスト | 取り込み時にLLM使用 | 検索時にLLM使用 |
| 柔軟性 | 事前定義パターンのみ | 文脈で動的に解釈 |

#### 検索戦略

| 軸 | コレクション | 検索方式 |
|----|-------------|---------|
| 材料軸 | materials_methods_collection | **キーワード検索**（BM25等） |
| 方法軸 | materials_methods_collection | **セマンティック検索**（ベクトル） |
| 総合軸 | combined_collection | **セマンティック検索**（ベクトル） |

#### スコアリング・リランキング

1. 各軸で検索を実行（材料: キーワード、方法・総合: セマンティック）
2. 結果を**比率を変えてブレンド**（例: 材料40%, 方法30%, 総合30%）
3. ブレンド後の候補に**リランキング**（Cohere Rerank等）をかけて最終スコアを算出

---

## アイデアメモ

- 材料+方法結合チャンクにより、LLMが番号と材料名の対応を文脈で理解可能に
- キーワード検索（材料）+ セマンティック検索（方法・総合）のハイブリッド
- ブレンド比率はパラメータ化して評価で最適値を探る

---

## 次のアクション

- [ ] コレクション構成の変更（3コレクション → 2コレクション）
- [ ] ingest.py の簡素化（正規化処理の削除）
- [ ] agent.py の検索ロジック変更（キーワード + セマンティック）
- [ ] ブレンド比率パラメータの追加
- [ ] リランキング処理の実装
- [ ] フロントエンドUIの更新（ブレンド比率設定など）
- [ ] 評価機能での性能比較

---

## 参考

- v1プロジェクト: `/Users/nori8774/jikkennote-search_v1`
- 既存のアイデアメモ: `docs/ideas/` 配下のファイル
