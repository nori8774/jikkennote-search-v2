# 本番環境テストチェックリスト

## テスト実施情報

- **テスト実施日**: ________
- **実施者**: ________
- **環境**:
  - フロントエンドURL: ________
  - バックエンドURL: ________

---

## 1. デプロイ確認

### 1.1 バックエンド

- [ ] Railwayにデプロイ完了
- [ ] ビルドログにエラーなし
- [ ] サーバーが起動している
- [ ] URLにアクセス可能: `https://your-backend.railway.app`
- [ ] ヘルスチェックが成功: `/health`
  ```bash
  curl https://your-backend.railway.app/health
  # 期待: {"status": "healthy", "version": "2.0.0", ...}
  ```

### 1.2 フロントエンド

- [ ] Vercelにデプロイ完了
- [ ] ビルドログにエラーなし
- [ ] URLにアクセス可能: `https://your-app.vercel.app`
- [ ] ホームページが正しく表示される
- [ ] ナビゲーションリンクが動作する

### 1.3 環境変数

#### バックエンド（Railway）

- [ ] `CORS_ORIGINS` が設定されている
- [ ] `HOST=0.0.0.0` が設定されている
- [ ] `PORT=8000` が設定されている
- [ ] フォルダパスが設定されている（オプション）

#### フロントエンド（Vercel）

- [ ] `NEXT_PUBLIC_API_URL` が設定されている
- [ ] バックエンドのURLが正しい

---

## 2. 基本機能テスト

### 2.1 初期設定

- [ ] 設定ページにアクセス可能: `/settings`
- [ ] APIキータブが表示される
- [ ] OpenAI API Keyを入力できる
- [ ] Cohere API Keyを入力できる
- [ ] 「設定を保存」ボタンが動作する
- [ ] 設定がlocalStorageに保存される
- [ ] ページをリロードしても設定が保持される

### 2.2 モデル選択

- [ ] モデル選択タブが表示される
- [ ] Embeddingモデルを選択できる
  - [ ] text-embedding-3-small
  - [ ] text-embedding-3-large
  - [ ] text-embedding-ada-002
- [ ] LLMモデルを選択できる
  - [ ] gpt-4o-mini
  - [ ] gpt-4o
  - [ ] gpt-4-turbo
  - [ ] gpt-3.5-turbo
- [ ] 選択がlocalStorageに保存される

### 2.3 プロンプト管理

- [ ] プロンプト管理タブが表示される
- [ ] デフォルトプロンプトが読み込まれる
- [ ] プロンプトを編集できる
- [ ] 「リセット」ボタンで初期値に戻る
- [ ] 「設定を保存」ボタンが動作する

---

## 3. ノート管理機能

### 3.1 ノート取り込み

**前提**: バックエンドサーバーの `/app/notes/new/` にテストノートを配置

- [ ] ノート管理ページにアクセス可能: `/ingest`
- [ ] ソースフォルダパスを入力できる
- [ ] 取り込み後のアクションを選択できる
  - [ ] ファイルを残す
  - [ ] アーカイブフォルダへ移動
  - [ ] ファイルを削除
- [ ] 「取り込み実行」ボタンが動作する
- [ ] 進捗状況が表示される
- [ ] 取り込み完了メッセージが表示される
- [ ] 取り込み件数が正しい

### 3.2 新出単語判定

**前提**: 新しい化学物質を含むノートを取り込む

- [ ] 新出単語が検出される
- [ ] LLM推奨が表示される
- [ ] 判定オプションを選択できる
  - [ ] 新規物質
  - [ ] 表記揺れ
  - [ ] スキップ
- [ ] 既存物質との類似度が表示される
- [ ] 「辞書を更新」ボタンが動作する
- [ ] 辞書が正しく更新される

---

## 4. 検索機能

### 4.1 基本検索

- [ ] 検索ページにアクセス可能: `/search`
- [ ] 検索条件を入力できる
  - [ ] 目的
  - [ ] 材料
  - [ ] 方法
  - [ ] 重点指示（オプション）
- [ ] 「検索」ボタンが動作する
- [ ] ローディング表示が出る
- [ ] 検索結果が表示される
  - [ ] 比較分析レポート
  - [ ] 上位3件のノート
- [ ] ノートIDが表示される
- [ ] スコアが表示される

### 4.2 検索結果の活用

- [ ] 「材料をコピー」ボタンが動作する
- [ ] コピーした材料が検索条件欄に反映される
- [ ] 「方法をコピー」ボタンが動作する
- [ ] コピーした方法が検索条件欄に反映される
- [ ] ノートIDをクリックするとビューワーに移動する

### 4.3 パフォーマンス

- [ ] 検索レスポンスタイム: **10秒以内**
  - 実測値: ________ 秒
- [ ] 検索結果が適切にランキングされている
- [ ] エラーが発生しない

---

## 5. ノートビューワー

### 5.1 ノート表示

- [ ] ビューワーページにアクセス可能: `/viewer`
- [ ] ノートIDを入力できる
- [ ] 「表示」ボタンが動作する
- [ ] ノートの内容が表示される
  - [ ] タイトル
  - [ ] 目的・背景セクション
  - [ ] 材料セクション
  - [ ] 方法セクション
  - [ ] 結果セクション

### 5.2 コピー機能

- [ ] 各セクションに「コピー」ボタンがある
- [ ] 「目的・背景をコピー」が動作する
- [ ] 「材料をコピー」が動作する
- [ ] 「方法をコピー」が動作する
- [ ] 「結果をコピー」が動作する
- [ ] クリップボードにコピーされる

---

## 6. 辞書管理機能

### 6.1 辞書閲覧

- [ ] 辞書管理ページにアクセス可能: `/dictionary`
- [ ] エントリ一覧が表示される
  - [ ] 正規化名
  - [ ] 表記揺れ
  - [ ] カテゴリ
- [ ] 統計情報が表示される
  - [ ] 総エントリ数
  - [ ] カテゴリ別集計
- [ ] 検索ボックスでフィルタリングできる

### 6.2 辞書エクスポート

- [ ] 「YAML出力」ボタンが動作する
- [ ] YAMLファイルがダウンロードされる
- [ ] 「JSON出力」ボタンが動作する
- [ ] JSONファイルがダウンロードされる
- [ ] 「CSV出力」ボタンが動作する
- [ ] CSVファイルがダウンロードされる
- [ ] ファイル内容が正しい

### 6.3 辞書インポート

- [ ] 「インポート」ボタンが動作する
- [ ] YAMLファイルをインポートできる
- [ ] JSONファイルをインポートできる
- [ ] CSVファイルをインポートできる
- [ ] インポート後に辞書が更新される
- [ ] 成功メッセージが表示される

---

## 7. 検索履歴機能

### 7.1 履歴表示

- [ ] 検索画面の「履歴」タブにアクセス可能
- [ ] 過去の検索履歴が表示される
- [ ] テーブル形式で表示される
  - [ ] 検索日時
  - [ ] 目的
  - [ ] 材料
  - [ ] 方法
  - [ ] 上位3件のノートID

### 7.2 履歴の再利用

- [ ] 履歴の行をクリックできる
- [ ] クリックすると検索条件が入力される
- [ ] そのまま再検索できる

### 7.3 履歴の削除

- [ ] 「削除」ボタンが動作する
- [ ] 確認ダイアログが表示される
- [ ] 削除後に履歴が更新される

---

## 8. RAG性能評価機能

### 8.1 テストケースインポート

**前提**: テストケースCSV/Excelファイルを準備

- [ ] 評価ページにアクセス可能: `/evaluate`
- [ ] 「テストケースをインポート」ボタンが動作する
- [ ] CSVファイルをインポートできる
- [ ] Excelファイルをインポートできる
- [ ] インポート後にテストケース一覧が表示される

### 8.2 評価実行

- [ ] 「評価を実行」ボタンが動作する
- [ ] 進捗状況が表示される
- [ ] 評価結果が表示される
  - [ ] nDCG@10
  - [ ] Precision@3
  - [ ] Recall@3
  - [ ] MRR

### 8.3 バッチ評価

- [ ] 「バッチ評価」ボタンが動作する
- [ ] 全テストケースが評価される
- [ ] 平均スコアが表示される

---

## 9. セキュリティテスト

### 9.1 HTTPS通信

- [ ] フロントエンドがHTTPSで配信される
- [ ] バックエンドがHTTPSで配信される
- [ ] すべてのAPIリクエストがHTTPS経由

### 9.2 CORS設定

- [ ] 許可されたオリジンからのアクセスが成功する
- [ ] 不正なオリジンからのアクセスがブロックされる
  ```bash
  # 別のドメインから試す
  curl -H "Origin: https://malicious-site.com" \
       https://your-backend.railway.app/health
  # 期待: CORSエラー
  ```

### 9.3 APIキー管理

- [ ] APIキーがlocalStorageに保存される
- [ ] APIキーがネットワークリクエストに含まれる（ヘッダー）
- [ ] APIキーがURLに含まれない
- [ ] バックエンドサーバーがAPIキーを保存しない

---

## 10. パフォーマンステスト

### 10.1 レスポンスタイム

| 機能 | 目標時間 | 実測値 | 合格 |
|------|---------|--------|------|
| ヘルスチェック | < 1秒 | ___秒 | [ ] |
| ホームページ表示 | < 2秒 | ___秒 | [ ] |
| 検索実行 | < 10秒 | ___秒 | [ ] |
| ノート取り込み（100件） | < 5分 | ___分 | [ ] |
| 辞書エクスポート（1000件） | < 10秒 | ___秒 | [ ] |

### 10.2 同時アクセス

- [ ] 複数ユーザーの同時検索が可能
- [ ] システムが安定している
- [ ] エラーが発生しない

---

## 11. エラーハンドリング

### 11.1 ネットワークエラー

- [ ] バックエンドが停止している場合にエラーメッセージが表示される
- [ ] タイムアウト時に適切なメッセージが表示される

### 11.2 APIキーエラー

- [ ] APIキーが未設定の場合にエラーメッセージが表示される
- [ ] APIキーが無効な場合にエラーメッセージが表示される

### 11.3 ファイルエラー

- [ ] 不正なファイル形式の場合にエラーメッセージが表示される
- [ ] ファイルサイズが大きすぎる場合にエラーメッセージが表示される

---

## 12. ブラウザ互換性テスト

### 12.1 Google Chrome

- [ ] すべての機能が動作する
- [ ] UIが正しく表示される
- [ ] パフォーマンスが良好

### 12.2 Mozilla Firefox

- [ ] すべての機能が動作する
- [ ] UIが正しく表示される

### 12.3 Microsoft Edge

- [ ] すべての機能が動作する
- [ ] UIが正しく表示される

### 12.4 Safari

- [ ] すべての機能が動作する
- [ ] UIが正しく表示される

---

## 13. レスポンシブデザインテスト

### 13.1 デスクトップ（1920x1080）

- [ ] レイアウトが正しい
- [ ] すべての要素が表示される

### 13.2 タブレット（768x1024）

- [ ] レイアウトが適切に調整される
- [ ] タッチ操作が可能

### 13.3 モバイル（375x667）

- [ ] レイアウトが縦並びになる
- [ ] タッチ操作が可能
- [ ] フォントサイズが適切

---

## 14. データ永続化テスト

### 14.1 ChromaDB

- [ ] ノートが取り込まれる
- [ ] サーバー再起動後もデータが保持される
- [ ] 検索が正常に動作する

### 14.2 正規化辞書

- [ ] 辞書が更新される
- [ ] サーバー再起動後も辞書が保持される

### 14.3 検索履歴

- [ ] 履歴が保存される
- [ ] サーバー再起動後も履歴が保持される

---

## 15. バックアップとリストアテスト

### 15.1 バックアップ

- [ ] ChromaDBをバックアップできる
- [ ] ノートファイルをバックアップできる
- [ ] 辞書をバックアップできる
- [ ] 履歴・評価データをバックアップできる

### 15.2 リストア

- [ ] バックアップからリストアできる
- [ ] リストア後にすべての機能が動作する
- [ ] データの整合性が保たれる

---

## 総合評価

### 合格基準

- [ ] すべての必須機能が動作する
- [ ] セキュリティテストに合格する
- [ ] パフォーマンステストに合格する
- [ ] 主要ブラウザで動作する

### 既知の問題

1. ________
2. ________
3. ________

### 今後の改善点

1. ________
2. ________
3. ________

---

## 承認

- **テスト実施者**: ________________ 日付: ________
- **承認者**: ________________ 日付: ________

---

**備考**:
