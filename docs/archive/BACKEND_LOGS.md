# バックエンドターミナル（ログ）の確認方法

性能評価実行時に、バックエンドのコンソールには以下のような詳細情報が出力されます。

## 出力内容

### 1. 評価モード開始
```
================================================================================
🔬 [評価モード] 性能評価実行中
================================================================================
```

### 2. 入力情報
```
📋 [入力情報]
  目的: [ユーザーが入力した目的]
  材料: [ユーザーが入力した材料]
  実験手法: [ユーザーが入力した実験手法]
  重点指示: [ユーザーが入力した重点指示]

📝 [正規化後の材料]
  [正規化された材料リスト]
```

### 3. 生成されたクエリ
```
🔍 [生成されたクエリ]
  統合クエリ（3個のクエリを結合）:
  [ベテラン + 新人 + マネージャー視点のクエリ統合版]

  各クエリの詳細:
    1. [ベテラン視点のクエリ]
    2. [新人視点のクエリ]
    3. [マネージャー視点のクエリ]
```

### 4. リランキング結果
```
📊 [リランキング結果] Top 10 件
  ============================================================================
  Rank  1 | Score: 0.956321 | ノートID: ID3-14
  Rank  2 | Score: 0.923456 | ノートID: ID2-8
  ...
  Rank 10 | Score: 0.781234 | ノートID: ID5-3
  ============================================================================
  ✅ 評価用に上位 10 件を返却します。
```

---

## 確認方法

### **ローカル開発環境の場合**

バックエンドを起動しているターミナルウィンドウを確認してください。

#### 1. バックエンドサーバーの起動
```bash
cd /Users/nori8774/jikkennote-search/backend
python server.py
```

このコマンドを実行したターミナルウィンドウに、リアルタイムでログが出力されます。

#### 2. ログの確認
- 性能評価ページで「全条件を評価」ボタンをクリック
- バックエンドのターミナルウィンドウに切り替え
- 上記のような詳細ログが出力されます

---

### **Railway（本番環境）の場合**

Railwayにデプロイしている場合、Web UI からログを確認できます。

#### 1. Railway ダッシュボードにアクセス
- https://railway.app にアクセス
- プロジェクトを選択

#### 2. バックエンドサービスを選択
- `jikkennote-backend` または該当するサービス名をクリック

#### 3. ログビューワーを開く
- 右上の「Logs」タブをクリック
- リアルタイムでログが表示されます

#### 4. ログのフィルタリング
- 検索ボックスで `[評価モード]` や `[リランキング結果]` で検索
- 特定の条件のログのみを表示できます

#### 5. ログのダウンロード
- 必要に応じて「Download Logs」ボタンでログファイルをダウンロード可能

---

### **Vercel Serverless Functions の場合**

バックエンドをVercel Serverless Functionsで動かしている場合:

#### 1. Vercel ダッシュボードにアクセス
- https://vercel.com にアクセス
- プロジェクトを選択

#### 2. Functions タブを開く
- 左サイドバーの「Functions」をクリック

#### 3. 対象の関数を選択
- `/api/search` などの関数を選択

#### 4. Logs セクションを確認
- リアルタイムログまたは過去のログを確認できます

**注意**: Serverless Functionsでは、ログの保持期間に制限があります（通常24時間〜7日間）。

---

## ログの活用方法

### 1. プロンプトのチューニング
- 「生成されたクエリ」セクションを確認
- 期待通りのクエリが生成されているかチェック
- 必要に応じてプロンプトを調整

### 2. 検索精度の検証
- 「リランキング結果」のスコアを確認
- 正解ノートが上位に来ているかチェック
- スコアが低い場合はプロンプトや材料の正規化を見直し

### 3. 正規化の確認
- 「正規化後の材料」セクションを確認
- 材料名が正しく統一されているかチェック
- 必要に応じて正規化辞書を更新

### 4. デバッグ
- エラーが発生した場合、ログから詳細なスタックトレースを確認
- どのノードで失敗したかを特定

---

## ログレベルの設定

バックエンドのログレベルを調整したい場合:

### `backend/config.py` を編集
```python
# ログレベル
LOG_LEVEL = "INFO"  # DEBUG, INFO, WARNING, ERROR
```

- `DEBUG`: 最も詳細なログ（開発時推奨）
- `INFO`: 通常のログ（デフォルト）
- `WARNING`: 警告以上のみ
- `ERROR`: エラーのみ

---

## トラブルシューティング

### ログが表示されない場合

#### ローカル環境
1. バックエンドサーバーが起動しているか確認
   ```bash
   lsof -i :8000
   ```
2. 正しいターミナルウィンドウを見ているか確認
3. `print()` ではなく `logging.info()` を使用しているか確認（コード側）

#### Railway
1. デプロイが成功しているか確認
2. サービスが起動しているか確認（Status: Active）
3. ログビューワーが最新の状態か確認（更新ボタンをクリック）

#### Vercel
1. 関数が正しくデプロイされているか確認
2. 実行時間制限（10秒）に達していないか確認
3. メモリ制限に達していないか確認

---

## まとめ

- **ローカル**: バックエンド起動中のターミナルを確認
- **Railway**: Webダッシュボードの「Logs」タブを確認
- **Vercel**: Webダッシュボードの「Functions」→「Logs」を確認

性能評価時のログを確認することで、検索の内部動作を詳細に把握し、プロンプトやパラメータのチューニングに役立てることができます。
